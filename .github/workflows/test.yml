name: test
on:
  push:
    branches: ["**"]
    paths-ignore:
      - "website/**"
      - "*.md"
      - "LICENSE"
      - ".all-contributorsrc"
jobs:
  test:
    runs-on: ubuntu-latest
    env:
      GO111MODULE: "on"
      UPTIMEROBOT_API_KEY: ${{ secrets.UPTIMEROBOT_API_KEY }}
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Set up Go
        uses: actions/setup-go@v2
        with:
          go-version: 1.14
      - name: Cache
        uses: actions/cache@v2.1.1
        with:
          path: ./vendor
          key: ${{ runner.os }}-${{ hashFiles('go.sum') }}
      - name: Build
        run: |
          go build -v
      - name: Run acceptance tests
        run: |
          TF_ACC=1 go test -coverprofile c.out -v ./...
      - uses: actions/upload-artifact@v2
        with:
          name: terraform-provider-uptimerobot
          path: /go/bin/terraform-provider-uptimerobot
